<!DOCTYPE html>
<html>
<head>
	<title>Health Bank</title>
	<meta charset="UTF-8">
	<script src="http://code.jquery.com/jquery-1.10.1.min.js"></script>
	<script src="../../js/healthbank.js"></script>
	<script src="../../js/underscore-min.js"></script>
	<script src="../../js/moment.min.js"></script>
  	<script src="http://code.jquery.com/ui/1.10.3/jquery-ui.js"></script>
	<link href="../../css/healthbank.css" rel="stylesheet" type="text/css">
	<link rel="stylesheet" href="http://code.jquery.com/ui/1.10.3/themes/smoothness/jquery-ui.css" />

	<script type="text/javascript">

		function updateFilterSelection(){
			if(!$("#filterEveryone").is(':checked')&& !$("#filterMyEntry").is(':checked') && !$("#filterIndCircle").is(':checked') && !$("#filterIndPeople").is(':checked')){
				$("#filterTop").html("No Filter<img src=\"../../images/navigate_down.png\" height=\"20px\"/>");
				$("#filterMyEntry").each(function(){ this.checked = true; });
				$("#filterEveryone").each(function(){ this.checked = true; });
			} else if(!$("#filterEveryone").is(':checked')&& $("#filterMyEntry").is(':checked') && !$("#filterIndCircle").is(':checked') && !$("#filterIndPeople").is(':checked')){
				$("#filterTop").html("My Entries<img src=\"../../images/navigate_down.png\" height=\"20px\"/>");
			} else if($("#filterEveryone").is(':checked')&& !$("#filterMyEntry").is(':checked') && !$("#filterIndCircle").is(':checked') && !$("#filterIndPeople").is(':checked')){
				$("#filterTop").html("No Filter<img src=\"../../images/navigate_down.png\" height=\"20px\"/>");
				$("#filterMyEntry").each(function(){ this.checked = true; });
				$("#filterEveryone").each(function(){ this.checked = true; });
			}

		}

		function initializeDropDown() {
			if(circles==undefined){
				setTimeout(function(){
					initializeDropDown();
				}, 100);
				return false;
			} else {
				$("#filterIndCircleList").html("");
				$("#filterIndPeopleList").html("");
				$.each(circles, function(i, item){
					$("#filterIndCircleList").append("<li><span><label><input id=\"filter_"+item._id.$oid+"\"type=\"checkbox\"/>"+item.name.substring(0,12)+"</label></span></li>");
					if(item.users!=undefined){
						$.each(item.users, function(j, u) {
							if(!$("#filter_"+u.userId).length){
								queryUsers(u.userId, {onSuccess: function(data){ // async!!
									var curUser = data.values.users[0];
									if(!$("#filter_"+u.userId).length){$("#filterIndPeopleList").append("<li><span><label><input id=\"filter_"+u.userId+"\"type=\"checkbox\"/>"+curUser.firstname+" "+curUser.lastname+"</label></span></li>");}
								}}); // end async!!
							} 
						});
					}

				});

				$("#filterIndCircleList input").change(function(){
					if(this.checked){
						$("#filterIndCircle").each(function(){ this.checked = true; });
						$("#filterIndCircle").change();
					}
				});
			}
			
			setTimeout(function(){
				$("#filterIndPeopleList input").change(function(){
					if(this.checked){
						$("#filterIndPeople").each(function(){ this.checked = true; });
						$("#filterIndPeople").change();
					}
				});
				param = getURLParameter("userId");
				if(param!=undefined){
					$("#filter_"+param).click();
				}
			}, 600);
		}

		$(document).ready(function() {
			initialize();
			initializeSpaces("spaces/spaces.html", "", 0);
			$.get(WEB_URL+'dialogs/not-implemented.html').success(function(data){$('body').append(data); loadedNotYetImplemented();});
			$("#createRecButton").click(function(){
				window.location = WEB_URL+"apps/addMedicalRecordApp.html"; 
				return false;
			});
			$("#filterMyEntry").change(function(){
				if(this.checked) {
					if(!$("#filterEveryone").is(':checked') && !$("#filterIndCircle").is(':checked') && !$("#filterIndPeople").is(':checked')){
						$("#filterTop").html("My Entries<img src=\"../../images/navigate_down.png\" height=\"20px\"/>");
					}
				}
				else { updateFilterSelection(); }
			});
			$("#filterEveryone").change(function(){
				if(this.checked) {
					$("#filterTop").html("No Filter<img src=\"../../images/navigate_down.png\" height=\"20px\"/>");
					$("#filterIndCircle").each(function(){ this.checked = false; });
					$("#filterIndPeople").each(function(){ this.checked = false; });
					$("#filterMyEntry").each(function(){ this.checked = true; });
					$("#filterIndPeopleList input").each(function(){ this.checked = false; });
					$("#filterIndCircleList input").each(function(){ this.checked = false; });
				}
				else { updateFilterSelection(); }
			});
			$("#filterIndCircle").change(function(){
				if(this.checked) {
					$("#filterTop").html("Individual Circles<img src=\"../../images/navigate_down.png\" height=\"20px\"/>");
					$("#filterEveryone").each(function(){ this.checked = false; });
					$("#filterIndPeople").each(function(){ this.checked = false; });
					$("#filterIndPeopleList input").each(function(){ this.checked = false; });
				}
				else { 
					updateFilterSelection(); 
					$("#filterIndCircleList input").each(function(){ this.checked = false; });
				}
			});
			$("#filterIndPeople").change(function(){
				if(this.checked) {
					$("#filterTop").html("Individual People<img src=\"../../images/navigate_down.png\" height=\"20px\"/>");
					$("#filterIndCircle").each(function(){ this.checked = false; });
					$("#filterEveryone").each(function(){ this.checked = false; });
					$("#filterIndCircleList input").each(function(){ this.checked = false; });
				}
				else { 
					updateFilterSelection(); 
					$("#filterIndPeopleList input").each(function(){ this.checked = false; });
				}
			});
			$("#filterDropdown li").hover(
	    			function(){
	        			$(this).children('ul').hide();
	        			$(this).children('ul').slideDown(100);
	    			},
	    			function () {
	        			$('ul', this).slideUp(50);            
	    		});
			$("#filterMyEntry").each(function(){ this.checked = true; });
			initializeDropDown();
		});
		
	</script>
</head>
<body>
	<!--Page-->
	<div id="hb-page">
		<div class="page-container">
			<!--Header-->
			<div class="page-header">
				<h1>Health record</h1> 
				<div class="page-actionbox">
					<span id="userInfo" class="userInfo"></span>
					<input id="logoutButton" type="submit" name="submit" value="Logout" class="page-logout-button" />
					<div class="searchbox">
						<span id="searchIconSpan"><img id="searchIcon" src="../../images/search-icon.png"/></span>
						<input id="search" type="text" x-webkit-speech/>
					</div>
				</div>
			</div>
			<!--END Header-->

			<div class="page-content-container">
				<!--Navi-->
				<ul id="navivation" class="page-navi">
					<li><a href="../home.html">Home</a></li>
					<li><a href="../profile.html">Profile</a></li>
					<li class="selectedLi"><a href="spaces.html">Spaces</a></li>
					<li><a href="../circles.html">Circles</a></li>
					<li><a href="../apps.html">Apps</a></li>
					<li><a href="../community.html">Community</a></li>
					<li><a href="../about.html">About</a></li>
				</ul>
				<!--END Navi-->

				<!--Content-->
				<div class="page-content spaces-page-content">
					<div id="tabs" class="tabs">
						<div id="all" class="tab tab-highlight"><a href="spaces.html">All Entries</a></div>
						<div id="medical" class="tab"><a href="medicalTimeline.html">Medical</a></div>
						<div id="wellness" class="tab"><a href="wellnessTimeline.html">Wellness</a></div>
						<div id="calories" class="tab"><a href="caloriesTimeline.html">Calories</a></div>
						<div id="newtab" class="tab new-tab"><img id="newTabIcon" src="../../images/plus.png" width="18px"/></div>
					</div>
					<div id="spaces-chronic-section">
						<div class="chronic-section-header">
							<h3 class="header-text">The latest records</h3>
							<input id="createRecButton" type="submit" name="submit" value="Create New Record" class="big-button" /></br>
							<ul id="filterDropdown">
							    <li class="filterLabel"><span>Filter entries:&nbsp;</span></li>
							    <li class="filterDD"><span id="filterTop">My Entries<img src="../../images/navigate_down.png" height="20px"/></span>
								<ul>
								    <li><span><label><input type="checkbox" id="filterEveryone"/>No Filter</label></span></li>
								    <li><span><label><input type="checkbox" id="filterMyEntry"/>My Entries</label></span></li>
								    <li><span><label><input type="checkbox"id="filterIndCircle"/>Individual Circles</label></span>
										<ul id="filterIndCircleList">
										    <li><span><label><input type="checkbox"/>Family</label></span></li>
								    	    <li><span><label><input type="checkbox"/>Friends</label></span></li>
								            <li><span><label><input type="checkbox"/>Medical Prof.</label></span></li>
								    	    <li><span><label><input type="checkbox"/>Wellness Prof.</label></span></li>
										</ul>
								    </li>
								    <li><span><label><input type="checkbox" id="filterIndPeople"/>Individual People</label></span>
										<ul id="filterIndPeopleList">  
								    	    <li><span><label><input type="checkbox"/>Dr. D. Kossmann</label></span></li>
								    	    <li><span><label><input type="checkbox"/>Hans Mustermann</label></span></li>
								    	    <li><span><label><input type="checkbox"/>Nadja Auer</label></span></li>
								    	    <li><span><label><input type="checkbox"/>Nasri Nahas</label></span></li>
										</ul>
								    </li>
								</ul>
							    </li>
							</ul>
						</div>
						<br/>
						<ul id="recordentries" class="recordentries">
							<center>
								<img style="height:60px; float:center; display: block; margin-left: auto; margin-right: auto;" src="../../images/loading.gif"></img>
								Loading...
							</center>
						</ul>
					</div>
				</div>
				<!--END Content-->
			</div>
		</div>
	</div>
	<!--END Page-->
	
	<!--Bg Gradient--><div class="gradient-page"></div><!--END Bg Gradient-->
	
	<!-- Bottom Bar -->
    <div class="hb-bottom">
		<span class="disclaimer">This is a project by Health Bank<sup>&copy;</sup>. All rights reserved. This website was elaborated by Patrick Tremp for his Master thesis.<span>
    	
        <span class="right">
    		<a href="http://www.healthbank.ch">
    			<img src="../../images/logo.png" style=" margin-top:6px; height: 80%;" title="To Health Bank" alt="ETHZ" />
    		</a>
    	</span>
    	<div class="clr"></div>
    </div>
	<!--END Bottom Bar -->
</body>
</html>